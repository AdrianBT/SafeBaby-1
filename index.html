<<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sample illustrating the use of Web Bluetooth / Device Info.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- link to main stylesheet -->
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <!--Title of the website-->
    <title>iBaby Sense</title>

    <script>
  // Add a global error event listener early on in the page load, to help ensure that browsers
  // which don't support specific functionality still end up displaying a meaningful message.
    window.addEventListener('error', function(error) {
      if (ChromeSamples && ChromeSamples.setStatus) {
        console.error(error);
        ChromeSamples.setStatus(error.message + ' (Your browser may not support this feature.)');
        error.preventDefault();
      }
    });
  </script>

  </head>
  <body>

    <h1>iBaby Sense</h1>
    <br/>
    <script type="text/javascript" src="javascripts/blth.js"></script>
        <script>
          document.querySelector('form').addEventListener('submit', function(event) {
            event.stopPropagation();
            event.preventDefault();

            if (isWebBluetoothEnabled()) {
              ChromeSamples.clearLog();
              onButtonClick();
            }
          });
        </script>

        <script>
          log = ChromeSamples.log;
          function isWebBluetoothEnabled() {
            if (navigator.bluetooth) {
              return true;
            } else {
              ChromeSamples.setStatus('Web Bluetooth API is not available.\n' +
              'Please make sure the "Experimental Web Platform features" flag is enabled.');
              return false;
            }
          }
        </script>

    <form>
      <label for="allDevices">All Devices</label>
      <input id="allDevices" type="checkbox">
      <input id="service" type="text" size=17 list="services" placeholder="Bluetooth Service">
      <input id="name" type="text" size=17 placeholder="Device Name">
      <input id="namePrefix" type="text" size=17 placeholder="Device Name Prefix">
      <button>Get Bluetooth Device Info</button>
    </form>

    <script>
      function onButtonClick() {
      let filters = [];

      let filterService = document.querySelector('#service').value;
      if (filterService.startsWith('0x')) {
        filterService = parseInt(filterService);
      }
      if (filterService) {
        filters.push({services: [filterService]});
      }

      let filterName = document.querySelector('#name').value;
      if (filterName) {
        filters.push({name: filterName});
      }

      let filterNamePrefix = document.querySelector('#namePrefix').value;
      if (filterNamePrefix) {
        filters.push({namePrefix: filterNamePrefix});
      }

      let options = {};
      if (document.querySelector('#allDevices').checked) {
        options.acceptAllDevices = true;
      } else {
        options.filters = filters;
      }

      log('Requesting Bluetooth Device...');
      log('with ' + JSON.stringify(options));
      navigator.bluetooth.requestDevice(options)
      .then(device => {
        log('-> BLE Device Name:             ' + device.name);
        log('-> BLE Id:               ' + device.id);
        log('-> BLE Device Status Connected:        ' + device.gatt.connected);
      })
      .catch(error => {
        log('Argh! ' + error);
      });
    }
  </script>



  </body>
</html>
